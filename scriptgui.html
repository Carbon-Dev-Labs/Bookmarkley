<!DOCTYPE html>
<html>

<head>
    <title>BookStack</title>
    <meta charset="utf-8">
    <link href="/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <style>
        .hoverred:hover {
            color: red;
        }
    </style>
</head>

<body style="width: relative;height: 500px;">
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Bookmarkley</a>
            <div class="" id="navbarText">
                <span class="navbar-text">
                    <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"><i
                            class="bi bi-list"></i></button>
                </span>
            </div>
        </div>
    </nav>

    <div style="padding:5%;">
        <div class="alert alert-warning" role="alert">
            Bookmarkley is still in beta, some things might not work.
        </div>

        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>Telemetry Notice</strong> Bookmarkley collects minimal Telemetry.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <h4>Tricks</h4>
        <div class="list-group">
            <button id="bkTrickTabCloak" type="button" class="list-group-item list-group-item-action">Tab Cloak</button>
            <button id="bkTrickTabBrowser" type="button" class="list-group-item list-group-item-action">In-Tab
                Brower</button>
            <button id="bkTrickUnblockPage" type="button" class="list-group-item list-group-item-action">Unblock
                Page</button>
            <button id="bkTrickEditMode" type="button" class="list-group-item list-group-item-action">Enable Edit
                Mode</button>
            <button id="bkTrickDevConsole" type="button" class="list-group-item list-group-item-action">Start Dev
                Console</button>
            <button id="bkFloodHistory" type="button" class="list-group-item list-group-item-action">Flood
                History</button>
        </div>

        <br>
    </div>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Bookmarkley</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body" style="padding: 5%;">

            <div class="list-group">
                <a href="scriptgui.html" class="list-group-item list-group-item-action active"
                    aria-current="true">Home</a>
                <a href="games.html" class="list-group-item list-group-item-action">Games</a>
                <a href="options.html" class="list-group-item list-group-item-action">Options</a>
                <button id="exitButton" type="button" class="list-group-item list-group-item-action">Exit</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="tabCloakModal" tabindex="-1" aria-labelledby="tabCloakModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Tab Cloak</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <button id="cloakTabButton" type="button" class="btn btn-primary">Cloak Tab</button>
                    <button id="resetTabButton" type="button" class="btn btn-primary">Reset Tab</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="tabCloakTitleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Tab Cloak</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="tabTitleInput" class="form-label">Tab Title</label>
                        <input type="text" class="form-control" id="tabTitleInput" aria-describedby="titleHelp">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="setTabCloakButton" type="button" class="btn btn-primary"
                        data-bs-dismiss="modal">Cloak</button>
                </div>
            </div>
        </div>
    </div>

    <div id="inTabModal" class="modal fade" id="tabCloakTitleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Browser URL</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="unblockInput" class="mb-3">
                        <label for="inTabUrlInput" class="form-label">Website URL</label>
                        <input type="text" class="form-control" id="inTabUrlInput" aria-describedby="urlHelp">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="goBrowseURLButton" type="button" class="btn btn-primary"
                        data-bs-dismiss="modal">Go</button>
                </div>
            </div>
        </div>
    </div>

    <div id="unblockModal" class="modal fade" id="tabCloakTitleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Tab Unblocker</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="unblockLoader" class="text-center justify-content-sm-center" style="display: grid;">
                        <label class="form-label">Attempting to fetch URL</label>
                        <div class="spinner-border mx-auto" role="status" style="margin-top: 10px;margin-bottom: 10px;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div id="unblockInput" class="mb-3" style="display: none;">
                        <label for="tabUrlInput" class="form-label">Website URL</label>
                        <input type="text" class="form-control" id="tabUrlInput" aria-describedby="urlHelp">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="setUnbURLButton" type="button" class="btn btn-primary" data-bs-dismiss="modal"
                        disabled>Unblock</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="historyFlooderModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">History Flooder</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        Flood your history with many instances of the current website.
                    </p>
                    <div class="mb-3">
                        <label for="floodNumInput" class="form-label">How Many Instances</label>
                        <input type="number" class="form-control" id="floodNumInput" aria-describedby="titleHelp" value="5">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="historyFloodButton" type="button" class="btn btn-primary"
                        data-bs-dismiss="modal">Flood</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="outOfDateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Bookmarkley Is Out of Date</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Your current version of Bookmarkley is out of date. This means your version might not have the
                    lasest features and bug fixes.
                    <br>
                    <br>
                    You are currently using <strong><span id="currentV">v0.1</span></strong>.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="updateButton" type="button" class="btn btn-primary" data-bs-dismiss="modal">Update
                        Version</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmExit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Are you sure?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to exit Bookmarkley? To reopen Bookmarkley, just click the bookmark again.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="confirmExitButton" type="button" class="btn btn-primary"
                        data-bs-dismiss="modal">Exit</button>
                </div>
            </div>
        </div>
    </div>

    <div style="margin: 12px;width: 92%;" id="tabCloakToast"
        class="toast align-items-center position-fixed bottom-0 end-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Tab Updated
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>

    <div style="margin: 12px;width: 92%;" id="historyFloodToast"
        class="toast align-items-center position-fixed bottom-0 end-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="editModeToastText">
                History Successfully Flooded <span id="floodNum">5</span> Times
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>

    <div style="margin: 12px;width: 92%;" id="editModeToast"
        class="toast align-items-center position-fixed bottom-0 end-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="editModeToastText">
                Edit Mode Enabled
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>

    <div style="margin: 12px;width: 92%;" id="devConsoleToast"
        class="toast align-items-center position-fixed bottom-0 end-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="editModeToastText">
                Started Dev Console
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</body>
<script src="/bootstrap.bundle.min.js"></script>
<script>
    const outOfDateModal = new bootstrap.Modal(document.getElementById('outOfDateModal'))
    const tabCloakModal = new bootstrap.Modal(document.getElementById('tabCloakModal'))
    const tabCloakTitleModal = new bootstrap.Modal(document.getElementById('tabCloakTitleModal'))
    const unblockModal = new bootstrap.Modal(document.getElementById('unblockModal'))
    const floodHistoryModal = new bootstrap.Modal(document.getElementById('historyFlooderModal'))
    const inTabModal = new bootstrap.Modal(document.getElementById('inTabModal'))
    const tabCloakToast = new bootstrap.Toast(document.getElementById('tabCloakToast'))
    const editModeToast = new bootstrap.Toast(document.getElementById('editModeToast'))
    const devConsoleToast = new bootstrap.Toast(document.getElementById('devConsoleToast'))
    const historyFloodToast = new bootstrap.Toast(document.getElementById('historyFloodToast'))
    const confirmExit = new bootstrap.Modal(document.getElementById('confirmExit'))
    let ogTabName = ''

    window.top.postMessage('rqdata|tabtitle', '*')

    window.onmessage = function (e) {
        let command = e.data.split('|')
        if (command[0] == 'updater') {
            if (command[1] == 'outdatedversion') {
                document.getElementById('currentV').innerText = command[2]
                outOfDateModal.show()
            }
        } else if (command[0] == 'rqdata') {
            if (command[1] == 'tabtitle') {
                ogTabName = command[2]
            } else if (command[1] == 'taburl') {
                document.getElementById('tabUrlInput').value = command[2]
                document.getElementById('unblockLoader').style.display = 'none'
                document.getElementById('unblockInput').style.display = 'block'
                document.getElementById('setUnbURLButton').disabled = false
            }
        } else if (command[0] == 'trick') {
            if (command[1] == 'tabcloak') {
                tabCloakToast.show()
            } else if (command[1] == 'editmode') {
                if (command[2] == 'false') {
                    document.getElementById('bkTrickEditMode').innerText = 'Enable Edit Mode'
                    document.getElementById('editModeToastText').innerText = 'Edit Mode Disabled'
                    editModeToast.show()
                } else if (command[2] == 'true') {
                    document.getElementById('bkTrickEditMode').innerText = 'Disable Edit Mode'
                    document.getElementById('editModeToastText').innerText = 'Edit Mode Enabled'
                    editModeToast.show()
                }
            } else if (command[1] == 'devconsole') {
                devConsoleToast.show()
            } else if (command[1] == 'flooder') {
                if (command[2] == 'success') {
                    document.getElementById('floodNum').innerText = command[3]
                    historyFloodToast.show()
                }
            }
        }
    };

    document.getElementById('bkTrickTabCloak').onclick = function () {
        tabCloakModal.show()
    }

    document.getElementById('bkTrickTabBrowser').onclick = function () {
        inTabModal.show()
    }

    document.getElementById('goBrowseURLButton').onclick = function () {
        window.top.postMessage('trick|tabbrowser|' + document.getElementById('inTabUrlInput').value, '*')
    }

    document.getElementById('bkTrickUnblockPage').onclick = function () {
        unblockModal.show()
        window.top.postMessage('rqdata|taburl', '*')
    }

    document.getElementById('setUnbURLButton').onclick = function () {
        window.top.postMessage('trick|unblock|' + document.getElementById('tabUrlInput').value, '*')
    }

    document.getElementById('bkTrickEditMode').onclick = function () {
        window.top.postMessage('trick|editmode', '*')
    }

    document.getElementById('bkTrickDevConsole').onclick = function () {
        window.top.postMessage('trick|devconsole', '*')
    }

    document.getElementById('cloakTabButton').onclick = function () {
        tabCloakTitleModal.show()
    }

    document.getElementById('setTabCloakButton').onclick = function () {
        window.top.postMessage('trick|tabcloak|' + document.getElementById('tabTitleInput').value, '*')
    }

    document.getElementById('resetTabButton').onclick = function () {
        window.top.postMessage('trick|tabcloak|' + ogTabName, '*')
    }

    document.getElementById('bkFloodHistory').onclick = function () {
        floodHistoryModal.show()
    }
    
    document.getElementById('historyFloodButton').onclick = function () {
        window.top.postMessage('trick|flooder|' + document.getElementById('floodNumInput').value, '*')
    }

    document.getElementById('exitButton').onclick = function () {
        window.top.postMessage('updater|open', '*')
    }

    document.getElementById('exitButton').onclick = function () {
        confirmExit.show()
    }

    document.getElementById('confirmExitButton').onclick = function () {
        window.top.postMessage('option|exit', '*')
    }
</script>

</html>